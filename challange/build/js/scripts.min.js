"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,c=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){c=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(c)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},cryptoCurrs=["ETH","LTC","BTC"],currencies=["USD","EUR","GBP","UAH"],signs=["$","€","£","₴"],urlBase="https://apiv2.bitcoinaverage.com/indices/global/ticker/",currencyElems=[],currentCurrElem=document.querySelector(".js-curr-selected"),cards=Array.from(document.querySelectorAll(".currency")),lastResults=null,initEventHandling=function(){var e=document.querySelector(".selector__current"),t=document.querySelector(".selector__options"),r=document.querySelectorAll(".js-curr-option");if(e&&t&&0<r.length){e.addEventListener("click",function(e){e.stopPropagation(),t.classList.toggle("hidden")});var n=function(e){e.stopPropagation(),e.target.classList.add("selector__current--highlighted")},c=function(e){e.stopPropagation(),e.target.classList.remove("selector__current--highlighted")};currentCurrElem.addEventListener("mouseenter",n),currentCurrElem.addEventListener("mouseleave",c),r.forEach(function(e){e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",c)})}document.addEventListener("click",function(){t.classList.contains("hidden")||t.classList.add("hidden")}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(t.classList.contains("hidden")||t.classList.add("hidden"))}),document.querySelectorAll(".js-switch-container").forEach(function(s){s.addEventListener("click",function(e){if(e.target.classList.contains("js-switch-slider")||e.target.classList.contains("js-switch-thumb")){var t=s.querySelector(".js-switch");if(t&&(t.checked=!t.checked,lastResults)){var r=e.target.closest(".currency"),n=r.dataset.currency,c=currentCurrElem.textContent,o=signs[currencies.indexOf(c)];setChanges(r,t.checked,lastResults[n].changes,o)}}})})},getRates=function(r){var n=[];return cryptoCurrs.forEach(function(e){var t=fetch(urlBase+e+r).then(function(e){if(e.ok)return e.json();throw new Error(e.statusText)});n.push(t)}),Promise.all(n)},changeSelectedCurrency=function(e,t){var r=currencyElems.filter(function(e){return e.classList.contains("hidden")})[0],n=e;currentCurrElem.textContent=t,n.classList.add("hidden"),r.classList.remove("hidden"),updateUI(t)};function updateUI(t){getRates(t).then(function(e){return e.reduce(function(e,t,r){return e[cryptoCurrs[r]]=t,e},{})}).then(function(e){return updateRates(t,e)}).catch(function(e){return console.log(e.message)})}function setChangeColor(e,t){t<0?(e.classList.remove("currency__change-value--ok"),e.classList.add("currency__change-value--danger")):(e.classList.remove("currency__change-value--danger"),e.classList.add("currency__change-value--ok"))}function setChanges(e,t,r,n){if(t){var c=r.percent,o=e.querySelector(".js-hour-change");o.textContent=formatNumber((c.hour<0?"":"+")+c.hour.toFixed(2))+"%",setChangeColor(o,c.hour);var s=e.querySelector(".js-day-change");s.textContent=formatNumber((c.day<0?"":"+")+c.day.toFixed(2))+"%",setChangeColor(s,c.day);var a=e.querySelector(".js-week-change");a.textContent=formatNumber((c.week<0?"":"+")+c.week.toFixed(2))+"%",setChangeColor(a,c.week);var i=e.querySelector(".js-month-change");i.textContent=formatNumber((c.month<0?"":"+")+c.month.toFixed(2))+"%",setChangeColor(i,c.month)}else{var u=r.price,l=e.querySelector(".js-hour-change");l.textContent=formatNumber((u.hour<0?"":"+")+u.hour.toFixed(2))+n,setChangeColor(l,u.hour);var d=e.querySelector(".js-day-change");d.textContent=formatNumber((u.day<0?"":"+")+u.day.toFixed(2))+n,setChangeColor(d,u.day);var h=e.querySelector(".js-week-change");h.textContent=formatNumber((u.week<0?"":"+")+u.week.toFixed(2))+n,setChangeColor(h,u.week);var m=e.querySelector(".js-month-change");m.textContent=formatNumber((u.month<0?"":"+")+u.month.toFixed(2))+n,setChangeColor(m,u.month)}}function updateRates(a,e){lastResults=e,Object.entries(e).forEach(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1],c=cards.filter(function(e){return e.dataset.currency===r})[0],o=c.querySelector(".js-price"),s=signs[currencies.indexOf(a)];o.textContent=s+formatNumber(n.last.toFixed(2),!1),setChanges(c,c.querySelector(".js-switch").checked,n.changes,s)})}var initUI=function(){var e=currencies[0];currentCurrElem.textContent=e;var n=document.querySelector(".js-currency-list");currencies.forEach(function(t,e){var r=document.createElement("li");r.className="selector__currency-item js-curr-option"+(0===e?" hidden":""),r.textContent=t,r.addEventListener("click",function(e){changeSelectedCurrency(r,t)}),n.appendChild(r),currencyElems.push(r)}),updateUI(e)};function formatNumber(e){var t="";(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])&&(t=e[0],e=e.slice(1));for(var r=e.split("."),n=[],c=Array.from(r[0]),o=void 0,s=void 0;s=0<(o=c.length%3)?c.splice(0,o):c.splice(0,Math.min(3,c.length)),n.push(s.join("")),0<c.length;);return t+(1<r.length?n.join(" ")+"."+r[1]:n.join(" "))}document.addEventListener("DOMContentLoaded",function(){initUI(),initEventHandling()});